# Debian・Ubuntu向け設定
- block:
  - name: debconf-utils install
    package:
      name: debconf-utils
      state: present

  - name: unattended-upgrades install
    package:
      name: unattended-upgrades
      state: present

  - name: apt-listchanges install
    package:
      name: apt-listchanges
      state: present
#  $ echo 'unattended-upgrades unattended-upgrades/enable_auto_updates boolean true' \
#  | sudo debconf-set-selections
#  $ sudo dpkg-reconfigure -f noninteractive -plow unattended-upgrades
  - name: create APT auto-upgrades configuration
    template:
      src: auto-upgrades.j2
      dest: /etc/apt/apt.conf.d/20auto-upgrades
      owner: root
      group: root
      mode: 0644

  - name: create unattended-upgrades configuration
    template:
      src: unattended-upgrades.j2
      dest: /etc/apt/apt.conf.d/50unattended-upgrades
      owner: root
      group: root
      mode: 0644
  # Debian・Ubuntu向け設定ここまで
  when: "ansible_os_family == 'Debian'"

# CentOS向け設定
- block:
  - name: yum-cron install
    package:
      name: yum-cron
      state: present
    notify:
      - enable yum-cron
      - restart yum-cron

  - name: yum-utils install
    package:
      name: yum-utils
      state: present

  # yum cron -----------------------------------------------------------------------------------------
  - name: /etc/yum/yum-cron.conf
    template:
      src: "yum-cron.conf.j2"
      dest: /etc/yum/yum-cron.conf
      owner: root
      group: root
      mode: 0644

  - name: /etc/cron.hourly/0yum-hourly.cron
    template:
      src: "0yum-hourly.cron.j2"
      dest: /etc/cron.hourly/0yum-hourly.cron
      owner: root
      group: root
      mode: 0755
  # CentOS向けここまで
  when: "ansible_os_family == 'RedHat'"
