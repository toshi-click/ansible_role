- name: xrdp install
  package:
    name: xrdp
    state: latest
  notify:
    - enable xrdp
    - restart xrdp

# OS分岐
# Debian・Ubuntu向け設定
- block:
  - name: ubuntu-desktop install
    package:
      name: ubuntu-desktop
      state: latest
  # Debian・Ubuntu向け設定ここまで
  when: "ansible_os_family == 'Debian'"

# CentOS向け設定
- block:
  - name: install the 'GNOME Desktop' package group
    command: 'yum -y groupinstall "GNOME Desktop"'
  # 日本語キーボード用の設定ファイル追加
  - name: "set /etc/xrdp/km-0411.ini"
    template:
      src: "key.ini.j2"
      dest: "/etc/xrdp/km-0411.ini"
      owner: root
      group: root
      mode: 0644

  - name: "set /etc/xrdp/km-e0010411.ini"
    template:
      src: "key.ini.j2"
      dest: "/etc/xrdp/km-e0010411.ini"
      owner: root
      group: root
      mode: 0644

  - name: "set /etc/xrdp/km-e0200411.ini"
    template:
      src: "key.ini.j2"
      dest: "/etc/xrdp/km-e0200411.ini"
      owner: root
      group: root
      mode: 0644

  - name: "set /etc/xrdp/km-e0210411.ini"
    template:
      src: "key.ini.j2"
      dest: "/etc/xrdp/km-e0210411.ini"
      owner: root
      group: root
      mode: 0644

  # GUI起動に切り替える
  - name: "Switch to GUI startup"
    command: systemctl set-default graphical.target
  # CentOS向けここまで
  when: "ansible_os_family == 'RedHat'"
